{"version":3,"file":"static/js/1415.3964f8f7.chunk.js","mappings":"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","sources":["preview/ItemEventBus.ts","preview/ItemWrapper/index.tsx","preview/index.tsx","pages/preview/index.tsx"],"sourcesContent":["import mitt, { Handler } from 'mitt';\nconst emitter = mitt<{ dispathEvent: any, [key: string]: any }>();\n\nemitter.on('dispathEvent', ({ target, action }) => {\n  console.log(`action.${action}.${target}`)\n  emitter.emit(`action.${action}.${target}`);\n});\n\n// action.refresh.-1657092518605\n\n\n\n// emitter.on('test.-1657092518605', () => {\n//   console.log(1111);\n// })\n\n// emitter.emit('test.-1657092518605')\n\nclass ItemEventBus {\n  protected id: string;\n  protected eventConfig: any;\n  constructor(id: any, eventConfig: any) {\n    this.id = id;\n    this.eventConfig = eventConfig;\n  }\n  on(type: string, hanlder: Handler<any>) {\n    emitter.on(`action.${type}.${this.id}`, hanlder);\n  }\n  off(type: string, hanlder: Handler<any>) {\n    emitter.off(`action.${type}.${this.id}`, hanlder);\n  }\n  emit(type: string) {\n    emitter.emit('dispathEvent', this.eventConfig[type])\n  }\n}\n\nexport default ItemEventBus;\n","import React from 'react';\nimport { IItem } from '../../editor-core/item';\nimport ItemEventBus from '../ItemEventBus';\n\ninterface IItemWrapperProps {\n  item: IItem,\n}\n\nconst ItemWrapper = ({ item }: IItemWrapperProps) => {\n  const { ViewComponent } = item.component;\n  const { id } = item;\n  const { size, position, rotate } = item.getShape();\n  const properties = item.getPropConfigValue();\n  const eventConfig = item.getEventConfigValue();\n  const eventBus = new ItemEventBus(id, eventConfig);\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        boxSizing: 'border-box',\n        width: size.width,\n        height: size.height,\n        transform: `translate(${position.x}px, ${position.y}px) rotate(${rotate}deg)`,\n      }}\n    >\n      <ViewComponent eventBus={eventBus} properties={properties} shape={{size, position, rotate}}></ViewComponent>\n    </div>\n  );\n}\n\nexport default React.memo(ItemWrapper);","import React from 'react';\nimport {IPage} from '../editor-core';\nimport { ISize, ScaleMode } from '../editor-core/page/IPage';\nimport ItemWrapper from './ItemWrapper';\n\nconst backgroundImage = 'http://datav-react.jiaminghi.com/demo/electronic-file/static/media/bg.110420cf.png';\n\ninterface IPreviewProps {\n  page: IPage,\n};\n\nfunction getViewportSize():ISize {\n  return {\n    width: document.documentElement.clientWidth,\n    height: document.documentElement.clientHeight,\n  };\n}\n\n\n\nfunction getStyle(size: ISize, viewport: ISize, scaleMode: ScaleMode): React.CSSProperties {\n  // // 等比缩放\n  if(scaleMode === ScaleMode.uniform) {\n    const AspectRatio = size.width / size.height; // 宽高比\n    const ViewAspectRatio = viewport.width / viewport.height;\n    let scale;\n    if(AspectRatio > ViewAspectRatio) {\n      scale  = viewport.width / size.width;\n    } else { \n      // 调整size.height到viewport.height\n      scale  = viewport.height / size.height;\n    }\n    return {\n      position: 'absolute',\n      top: '50%',\n      left: '50%',\n      transformOrigin: '0px 0px',    transform: `scale(${scale}) translate(-50%, -50%)`,\n\n    };\n  } else if (scaleMode === ScaleMode.stretch) {\n    // 拉伸\n    const scaleX = viewport.width / size.width;\n    const scaleY = viewport.height / size.height;\n    return {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      transformOrigin: '0px 0px',\n      transform: `scale(${scaleX}, ${scaleY})`,\n    };\n  } else if (scaleMode === ScaleMode.filled) {\n    // 充满屏幕\n    const AspectRatio = size.width / size.height; // 宽高比\n    const ViewAspectRatio = viewport.width / viewport.height;\n    let scale;\n    if(AspectRatio > ViewAspectRatio) {\n      scale  = viewport.height / size.height;\n    } else { \n      scale  = viewport.width / size.width;\n    }\n    return {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      transformOrigin: '0px 0px',\n      transform: `scale(${scale})`,\n    };\n  } else {\n    // 原始尺寸\n    return {\n      position: 'absolute',\n      top: '50%',\n      left: '50%',\n      transformOrigin: '0px 0px',\n      transform: `translate(-50%, -50%)`,\n    }\n  }\n}\n\nconst Preview = ({ page }: IPreviewProps) => {\n  const items = page.getItems();\n  const { size, scaleMode, backgroundColor } = page.getConfig();\n  const [viewport, setViewport] = React.useState(getViewportSize());\n  \n  const style = getStyle(size, viewport, scaleMode);\n  const handleResize = () => {\n    setViewport(getViewportSize());\n  };\n  React.useEffect(() => {\n    window.addEventListener('resize', handleResize);\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    }\n  }, []);\n  return (\n    <div\n      style={{\n        width: '100vw',\n        height: '100vh',\n        backgroundColor,\n      }}\n    >\n      <div\n        style={{\n          width: size.width,\n          height: size.height,\n          backgroundRepeat: 'no-repeat',\n          backgroundSize: 'cover',\n          \n          backgroundImage: `url(${backgroundImage})`,\n          ...style,\n        }}\n      >\n        {items.map(item => <ItemWrapper item={item} />)}\n      </div>\n\n    </div>\n  )\n}\n\nexport default React.memo(Preview);\n","import React from 'react';\nimport editor from '../../default/editor';\nimport Preview from '../../preview';\nconst PreviewPage = () => {\n  const data = localStorage.getItem('data');\n  if(!data) return null;\n  const page = editor.deserializePage(JSON.parse(data))\n  return <Preview page={page} />;\n}\n\nexport default PreviewPage;\n"],"names":["emitter","mitt","on","target","action","console","log","emit","ItemEventBus","id","eventConfig","this","type","hanlder","off","ItemWrapper","item","ViewComponent","component","getShape","size","position","rotate","properties","getPropConfigValue","getEventConfigValue","eventBus","style","top","left","boxSizing","width","height","transform","x","y","shape","React","getViewportSize","document","documentElement","clientWidth","clientHeight","Preview","page","items","getItems","getConfig","scaleMode","backgroundColor","viewport","setViewport","scale","ScaleMode","transformOrigin","scaleX","scaleY","getStyle","handleResize","window","addEventListener","removeEventListener","backgroundRepeat","backgroundSize","backgroundImage","map","data","localStorage","getItem","editor","JSON","parse"],"sourceRoot":""}